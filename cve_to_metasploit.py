from selenium import webdriver
import pandas as pd
import time
import csv

driver = webdriver.Firefox(executable_path=r'PATH\geckodriver.exe')

data = pd.ExcelFile(r'PATH\data.xlsx')
df = data.parse(0)
df = df.values.T[0].tolist()
print(df)

modules = list()
temp = list()

# data = pd.ExcelFile(r'PATH\data.xlsx')
# df = data.parse(0)
# df = df.values.T[0].tolist()
# print(df)

# modules = list()
# temp = list()


for cve in df:
    driver.get("https://www.rapid7.com/db/?q=&type=metasploit")
    print(cve)
    search_box = driver.find_element_by_xpath("""//*[@id="vdbSearch"]/section/div/input""")
    search_box.send_keys(cve)
    time.sleep(2)
    search_box.submit()
    time.sleep(10)

    try:
        first_result = driver.find_element_by_xpath("""/html/body/div[4]/div/div[3]/div[2]/div/section[3]/a""").get_attribute("href")
    except:
        try:
            first_result = driver.find_element_by_xpath("""/html/body/div[4]/div/div[3]/div[2]/div/section[3]/a[1]""").get_attribute("href")
        except:
            first_result = "No Result"


    temp = [cve, first_result]
    modules.append(temp)
    print(temp)
    time.sleep(2)

csvfile = open(r'PATH\modules.csv', 'w')
writer = csv.writer(csvfile)
writer.writerows(modules)

csvfile.close()
